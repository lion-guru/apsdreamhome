<div class="database-section">
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> This section documents the database schema for the APS Dream Home system, including tables, relationships, and key fields.
    </div>

    <h3><i class="fas fa-project-diagram"></i> Database Relationship Diagram</h3>
    <div class="card mb-4">
        <div class="card-body">
            <p>The APS Dream Home database follows a relational model with the following key relationships:</p>
            <ul>
                <li><strong>Users</strong> manage <strong>Properties</strong> (one-to-many)</li>
                <li><strong>Properties</strong> generate <strong>Leads</strong> (one-to-many)</li>
                <li><strong>Customers</strong> create <strong>Leads</strong> and schedule <strong>Property Visits</strong> (one-to-many)</li>
                <li><strong>Property Visits</strong> generate <strong>Visit Reminders</strong> (one-to-many)</li>
                <li><strong>Users</strong> receive <strong>Notifications</strong> (one-to-many)</li>
                <li><strong>MLM Commission</strong> system tracks referrals and payments</li>
            </ul>
        </div>
    </div>

    <h3><i class="fas fa-table"></i> Core Tables</h3>

    <!-- Users Table -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-users"></i> users
        </div>
        <div class="card-body">
            <p>Stores information about all system users including administrators, agents, associates, and customers.</p>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Constraints</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT</td>
                            <td>Unique identifier</td>
                            <td>PRIMARY KEY, AUTO_INCREMENT</td>
                        </tr>
                        <tr>
                            <td><code>first_name</code></td>
                            <td>VARCHAR(100)</td>
                            <td>User's first name</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>last_name</code></td>
                            <td>VARCHAR(100)</td>
                            <td>User's last name</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>email</code></td>
                            <td>VARCHAR(255)</td>
                            <td>User's email address</td>
                            <td>UNIQUE, NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>password</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Hashed password</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>phone</code></td>
                            <td>VARCHAR(20)</td>
                            <td>User's phone number</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>role</code></td>
                            <td>ENUM</td>
                            <td>User role (admin, agent, associate, customer)</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>ENUM</td>
                            <td>Account status (active, inactive, suspended)</td>
                            <td>NOT NULL, DEFAULT 'active'</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Account creation timestamp</td>
                            <td>DEFAULT CURRENT_TIMESTAMP</td>
                        </tr>
                        <tr>
                            <td><code>updated_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Last update timestamp</td>
                            <td>NULL ON UPDATE CURRENT_TIMESTAMP</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Properties Table -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-home"></i> properties
        </div>
        <div class="card-body">
            <p>Stores information about real estate properties available in the system.</p>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Constraints</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT</td>
                            <td>Unique identifier</td>
                            <td>PRIMARY KEY, AUTO_INCREMENT</td>
                        </tr>
                        <tr>
                            <td><code>title</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Property title</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>description</code></td>
                            <td>TEXT</td>
                            <td>Detailed property description</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>address</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Property address</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>price</code></td>
                            <td>DECIMAL(12,2)</td>
                            <td>Property price</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>bedrooms</code></td>
                            <td>INT</td>
                            <td>Number of bedrooms</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>bathrooms</code></td>
                            <td>DECIMAL(3,1)</td>
                            <td>Number of bathrooms</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>area</code></td>
                            <td>DECIMAL(10,2)</td>
                            <td>Property area in square feet</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>type</code></td>
                            <td>VARCHAR(50)</td>
                            <td>Property type (apartment, house, villa, etc.)</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>ENUM</td>
                            <td>Property status (available, sold, under contract)</td>
                            <td>NOT NULL, DEFAULT 'available'</td>
                        </tr>
                        <tr>
                            <td><code>owner_id</code></td>
                            <td>INT</td>
                            <td>ID of the agent managing this property</td>
                            <td>FOREIGN KEY (users.id)</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Property creation timestamp</td>
                            <td>DEFAULT CURRENT_TIMESTAMP</td>
                        </tr>
                        <tr>
                            <td><code>updated_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Last update timestamp</td>
                            <td>NULL ON UPDATE CURRENT_TIMESTAMP</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Customers Table -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-user-friends"></i> customers
        </div>
        <div class="card-body">
            <p>Stores information about customers who have inquired about properties or scheduled visits.</p>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Constraints</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT</td>
                            <td>Unique identifier</td>
                            <td>PRIMARY KEY, AUTO_INCREMENT</td>
                        </tr>
                        <tr>
                            <td><code>name</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Customer's full name</td>
                            <td>NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>email</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Customer's email address</td>
                            <td>UNIQUE, NOT NULL</td>
                        </tr>
                        <tr>
                            <td><code>phone</code></td>
                            <td>VARCHAR(20)</td>
                            <td>Customer's phone number</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>address</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Customer's address</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Record creation timestamp</td>
                            <td>DEFAULT CURRENT_TIMESTAMP</td>
                        </tr>
                        <tr>
                            <td><code>updated_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Last update timestamp</td>
                            <td>NULL ON UPDATE CURRENT_TIMESTAMP</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <h3><i class="fas fa-link"></i> Key Relationships</h3>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Relationship</th>
                    <th>Tables</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>User-Property</td>
                    <td>users → properties</td>
                    <td>One-to-Many</td>
                    <td>An agent (user) can manage multiple properties</td>
                </tr>
                <tr>
                    <td>Property-Lead</td>
                    <td>properties → leads</td>
                    <td>One-to-Many</td>
                    <td>A property can generate multiple leads</td>
                </tr>
                <tr>
                    <td>Customer-Lead</td>
                    <td>customers → leads</td>
                    <td>One-to-Many</td>
                    <td>A customer can generate multiple leads</td>
                </tr>
                <tr>
                    <td>Property-Visit</td>
                    <td>properties → property_visits</td>
                    <td>One-to-Many</td>
                    <td>A property can have multiple scheduled visits</td>
                </tr>
                <tr>
                    <td>Customer-Visit</td>
                    <td>customers → property_visits</td>
                    <td>One-to-Many</td>
                    <td>A customer can schedule multiple property visits</td>
                </tr>
                <tr>
                    <td>Visit-Reminder</td>
                    <td>property_visits → visit_reminders</td>
                    <td>One-to-Many</td>
                    <td>A property visit can have multiple reminders (24h, 1h)</td>
                </tr>
                <tr>
                    <td>User-Notification</td>
                    <td>users → notifications</td>
                    <td>One-to-Many</td>
                    <td>A user can receive multiple notifications</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3><i class="fas fa-database"></i> Database Management Tools</h3>
    <p>The APS Dream Home system includes several database management tools to maintain data integrity and optimize performance:</p>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Data Management</div>
                <div class="card-body">
                    <ul>
                        <li><strong>Database Optimizer</strong> - Cleans and optimizes tables</li>
                        <li><strong>Dashboard Data Manager</strong> - Refreshes widget data</li>
                        <li><strong>Structure-Based Seeder</strong> - Populates demo data</li>
                        <li><strong>Date Refresher</strong> - Updates date-based data</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Database Maintenance</div>
                <div class="card-body">
                    <ul>
                        <li><strong>Backup & Restore Tool</strong> - Manages database backups</li>
                        <li><strong>Migration Manager</strong> - Handles schema changes</li>
                        <li><strong>Dashboard Verification Report</strong> - Checks data status</li>
                        <li><strong>System Health Check</strong> - Verifies database integrity</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="alert alert-warning mt-4">
        <h4><i class="fas fa-exclamation-triangle"></i> Important Notes</h4>
        <ul>
            <li>Always use the Backup & Restore Tool before making significant changes to the database structure.</li>
            <li>Use the Migration Manager for all schema changes to maintain version control.</li>
            <li>Run the System Health Check periodically to ensure database integrity.</li>
            <li>The Database Optimizer should be run during low-traffic periods.</li>
        </ul>
    </div>

    <div class="mt-4">
        <a href="../database/index.php" class="btn btn-primary">
            <i class="fas fa-tools"></i> Access Database Management Hub
        </a>
    </div>
</div>
