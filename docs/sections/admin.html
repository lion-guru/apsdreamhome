<div class="admin-section">
    <div class="alert alert-primary">
        <i class="fas fa-info-circle"></i> This section provides comprehensive guidance for system administrators on managing the APS Dream Home platform, with special focus on API security and management.
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-key"></i> API Key Management
        </div>
        <div class="card-body">
            <p>As an administrator, you have full control over API keys and their permissions through the API Key Manager.</p>
            
            <h5>Accessing the API Key Manager</h5>
            <ol>
                <li>Log in to the admin dashboard</li>
                <li>Navigate to <a href="../admin/api_key_manager.php">API Key Manager</a> in the sidebar</li>
            </ol>
            
            <h5>Creating a New API Key</h5>
            <ol>
                <li>Click the "Generate New API Key" button</li>
                <li>Fill in the required information:
                    <ul>
                        <li><strong>Name/Description</strong> - A descriptive name for the API key (e.g., "Mobile App Integration")</li>
                        <li><strong>Permissions</strong> - Select the appropriate permissions for this key</li>
                        <li><strong>Rate Limit</strong> - Set the hourly request limit (default: 100)</li>
                        <li><strong>Expiration</strong> - Set an expiration date (optional)</li>
                    </ul>
                </li>
                <li>Click "Create API Key"</li>
                <li><strong>Important:</strong> Copy and securely store the API key that is displayed. For security reasons, the full key will not be displayed again.</li>
            </ol>
            
            <div class="alert alert-warning">
                <strong>Security Note:</strong> API keys should be treated as sensitive credentials. Always use secure channels when sharing API keys with developers or partners.
            </div>
            
            <h5>Managing Existing API Keys</h5>
            <p>From the API Key Manager, you can:</p>
            <ul>
                <li><strong>View Details</strong> - See key information, permissions, and usage statistics</li>
                <li><strong>Edit Permissions</strong> - Modify the permissions assigned to a key</li>
                <li><strong>Adjust Rate Limits</strong> - Increase or decrease the hourly request limit</li>
                <li><strong>Revoke Keys</strong> - Immediately invalidate a key if it has been compromised</li>
                <li><strong>View Usage Logs</strong> - Monitor API usage and detect unusual patterns</li>
            </ul>
            
            <h5>API Usage Monitoring</h5>
            <p>The API Key Manager provides detailed usage statistics for each API key:</p>
            <ul>
                <li>Total requests over time</li>
                <li>Requests by endpoint</li>
                <li>Error rates and types</li>
                <li>Rate limit violations</li>
            </ul>
            <p>Regularly review these statistics to identify potential issues or abuse.</p>
        </div>
    </div>

    <h3><i class="fas fa-shield-alt"></i> API Security Best Practices</h3>
    <div class="card mb-4">
        <div class="card-body">
            <p>Follow these best practices to maintain the security of your API:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>Key Management</h5>
                    <ul>
                        <li>Regularly rotate API keys (recommended: every 90 days)</li>
                        <li>Use descriptive names to easily identify the purpose of each key</li>
                        <li>Implement the principle of least privilege - only grant necessary permissions</li>
                        <li>Set appropriate rate limits based on expected usage</li>
                        <li>Revoke unused or compromised keys immediately</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Monitoring & Auditing</h5>
                    <ul>
                        <li>Regularly review API usage logs for suspicious activity</li>
                        <li>Set up alerts for unusual request patterns</li>
                        <li>Monitor rate limit violations</li>
                        <li>Conduct periodic audits of active API keys</li>
                        <li>Document all API key issuances and revocations</li>
                    </ul>
                </div>
            </div>
            
            <h5>Responding to Security Incidents</h5>
            <ol>
                <li><strong>Identify the compromised key</strong> - Use logs to determine which key was affected</li>
                <li><strong>Revoke the key immediately</strong> - Use the API Key Manager to invalidate the key</li>
                <li><strong>Notify affected parties</strong> - Inform the key owner about the revocation</li>
                <li><strong>Issue a new key</strong> - Generate a replacement key with appropriate permissions</li>
                <li><strong>Review logs</strong> - Analyze logs to assess any potential damage</li>
                <li><strong>Document the incident</strong> - Record details for future reference</li>
            </ol>
        </div>
    </div>

    <h3><i class="fas fa-cogs"></i> API Configuration Settings</h3>
    <div class="card mb-4">
        <div class="card-body">
            <p>The following system settings can be configured to customize API behavior:</p>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Setting</th>
                            <th>Description</th>
                            <th>Default Value</th>
                            <th>Recommended Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Default Rate Limit</td>
                            <td>Default hourly request limit for new API keys</td>
                            <td>100</td>
                            <td>100-500 (based on expected usage)</td>
                        </tr>
                        <tr>
                            <td>Rate Limit Window</td>
                            <td>Time window for rate limiting (in seconds)</td>
                            <td>3600 (1 hour)</td>
                            <td>3600 (1 hour)</td>
                        </tr>
                        <tr>
                            <td>Key Expiration</td>
                            <td>Default expiration period for new API keys</td>
                            <td>Never</td>
                            <td>365 days</td>
                        </tr>
                        <tr>
                            <td>Log Retention</td>
                            <td>How long to keep API request logs</td>
                            <td>30 days</td>
                            <td>90 days</td>
                        </tr>
                        <tr>
                            <td>CORS Allowed Origins</td>
                            <td>Domains allowed to access the API via CORS</td>
                            <td>None</td>
                            <td>Your trusted domains only</td>
                        </tr>
                        <tr>
                            <td>Required Authentication</td>
                            <td>Whether authentication is required for all endpoints</td>
                            <td>False</td>
                            <td>True (with exceptions for public endpoints)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <p>These settings can be modified in the <a href="../admin/system_settings.php">System Settings</a> page.</p>
        </div>
    </div>

    <h3><i class="fas fa-user-shield"></i> User Permission Management</h3>
    <div class="card mb-4">
        <div class="card-body">
            <p>The APS Dream Home system uses a role-based permission system to control access to features and data.</p>
            
            <h5>User Roles</h5>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Role</th>
                            <th>Description</th>
                            <th>API Access</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Administrator</td>
                            <td>Full system access</td>
                            <td>Can manage all API keys and settings</td>
                        </tr>
                        <tr>
                            <td>Agent</td>
                            <td>Property and lead management</td>
                            <td>Can use API for assigned properties and leads</td>
                        </tr>
                        <tr>
                            <td>Associate</td>
                            <td>Limited system access</td>
                            <td>Read-only API access to relevant data</td>
                        </tr>
                        <tr>
                            <td>Customer</td>
                            <td>Public website access</td>
                            <td>No direct API access</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h5>Managing User Permissions</h5>
            <ol>
                <li>Navigate to <a href="../admin/user_management.php">User Management</a></li>
                <li>Select a user to edit</li>
                <li>Modify their role or specific permissions</li>
                <li>Save changes</li>
            </ol>
            
            <p>Changes to user permissions take effect immediately.</p>
        </div>
    </div>

    <h3><i class="fas fa-database"></i> Database Management</h3>
    <div class="card mb-4">
        <div class="card-body">
            <p>The APS Dream Home system includes several tools for database management and maintenance:</p>
            
            <h5>Database Management Hub</h5>
            <p>Access the <a href="../database/index.php">Database Management Hub</a> to use these tools:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <ul>
                        <li><strong>Dashboard Data Manager</strong> - Check and refresh widget data</li>
                        <li><strong>Dashboard Verification Report</strong> - Verify data integrity</li>
                        <li><strong>Database Optimizer</strong> - Clean and optimize tables</li>
                        <li><strong>Backup & Restore Tool</strong> - Manage database backups</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul>
                        <li><strong>Date Refresher</strong> - Update date-based demo data</li>
                        <li><strong>Structure-Based Seeder</strong> - Populate demo data</li>
                        <li><strong>System Health Check</strong> - Verify system integrity</li>
                        <li><strong>API Documentation Tool</strong> - Generate API documentation</li>
                    </ul>
                </div>
            </div>
            
            <h5>Recommended Maintenance Schedule</h5>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Frequency</th>
                            <th>Tool</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Database Backup</td>
                            <td>Daily</td>
                            <td>Backup & Restore Tool</td>
                        </tr>
                        <tr>
                            <td>System Health Check</td>
                            <td>Weekly</td>
                            <td>System Health Check</td>
                        </tr>
                        <tr>
                            <td>Database Optimization</td>
                            <td>Monthly</td>
                            <td>Database Optimizer</td>
                        </tr>
                        <tr>
                            <td>API Usage Audit</td>
                            <td>Monthly</td>
                            <td>API Key Manager</td>
                        </tr>
                        <tr>
                            <td>API Key Rotation</td>
                            <td>Quarterly</td>
                            <td>API Key Manager</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <h3><i class="fas fa-code"></i> API Documentation Management</h3>
    <div class="card mb-4">
        <div class="card-body">
            <p>The APS Dream Home system includes an API Documentation Tool that automatically generates documentation for all API endpoints.</p>
            
            <h5>Accessing the API Documentation Tool</h5>
            <ol>
                <li>Navigate to the <a href="../database/index.php">Database Management Hub</a></li>
                <li>Click on "API Documentation Tool"</li>
            </ol>
            
            <h5>Features</h5>
            <ul>
                <li>Automatic endpoint discovery</li>
                <li>Parameter documentation</li>
                <li>Response format examples</li>
                <li>Authentication requirements</li>
                <li>Error code documentation</li>
            </ul>
            
            <h5>Customizing Documentation</h5>
            <p>You can customize the generated documentation by editing the API endpoint files and adding PHPDoc comments.</p>
            <p>Example:</p>
            <pre><code>/**
 * @api {get} /api/properties/search.php Search Properties
 * @apiName SearchProperties
 * @apiGroup Properties
 * @apiDescription Search for properties based on various criteria
 * 
 * @apiParam {Number} [min_price] Minimum price
 * @apiParam {Number} [max_price] Maximum price
 * @apiParam {Number} [bedrooms] Number of bedrooms
 * @apiParam {Number} [bathrooms] Number of bathrooms
 * @apiParam {String} [property_type] Type of property
 * @apiParam {String} [status] Property status
 * @apiParam {Number} [limit=10] Number of results to return
 * @apiParam {Number} [offset=0] Pagination offset
 * 
 * @apiSuccess {String} status Success status
 * @apiSuccess {Number} count Number of results
 * @apiSuccess {Object[]} properties List of properties
 */</code></pre>
        </div>
    </div>

    <div class="alert alert-info mt-4">
        <h4><i class="fas fa-lightbulb"></i> Administrator Tips</h4>
        <ul>
            <li>Regularly review API usage logs to identify potential security issues</li>
            <li>Implement a formal process for issuing and revoking API keys</li>
            <li>Document all API integrations and their associated keys</li>
            <li>Conduct periodic security audits of the API system</li>
            <li>Keep the system updated with the latest security patches</li>
        </ul>
    </div>
</div>
