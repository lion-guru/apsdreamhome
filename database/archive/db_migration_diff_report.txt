# APS Dream Homes CRM â€” Database Migration Diff Report

## Purpose
This file compares the old and new database structures for the APS Dream Homes CRM project and lists what needs to be changed, added, or verified for migration.

---

## 1. Users Table
- **Old:** `users` table existed with login/registration logic.
- **New:** `users` table may be missing or has changed structure (see `setup_demo_environment.sql`, `users_table.sql`, etc.).
- **Action:**
    - Ensure `users` table exists with required columns: `id`, `name`, `email`, `password`, `phone`, `utype`/`user_type`, `created_at`, `status`, etc.
    - Update code in `login.php`, `register.php`, `forgot_password.php`, etc. to match new structure.

## 2. Associates Table (MLM/Referral)
- **Old:** `associates` table with MLM/referral structure.
- **New:** Structure changed (see `mlm_tables.sql`, `setup_demo_environment.sql`).
- **Action:**
    - Verify `associates` table columns: `id`/`associate_id`, `name`, `email`, `phone`, `parent_id`/`sponsor_id`, `level`, `commission_percent`, etc.
    - Update code in `assosiate_dashboard.php`, `downline.php`, MLM/referral logic to match new structure.

## 3. Contact/Backup Tables
- **Old:** `contact_backup` table used for contact form.
- **New:** Table missing in new DB.
- **Action:**
    - Recreate `contact_backup` table if contact form (`contact.php`) is needed.
    - Update code to use new/existing table.

## 4. Bookings & Properties
- **Verify:** `bookings`, `properties`, `projects`, `plots` tables exist with correct columns (see `aps_schema_recommended.sql`, `schema.sql`).
- **Action:**
    - Check all columns used in code are present (e.g., `booking_date`, `customer_id`, `associate_id`, `status`, etc.).

## 5. Admin & Roles
- **Verify:** `admin`, `roles` tables exist (see `setup_demo_environment.sql`, `create_roles_table.sql`).
- **Action:**
    - Ensure admin login and permissions logic matches table structure.

## 6. Commission/Referral
- **Old:** Custom tables for commission transactions.
- **New:** Check for `commission_transactions`, `payouts`, `payout_slabs` (see `mlm_tables.sql`, `apsdreamhomes.sql`).
- **Action:**
    - Update code to match new table/column names and relationships.

## 7. Other Modules
- **Check:**
    - `gallery`, `testimonials`, `news`, `leads`, `opportunities`, `activities`, `campaigns`, etc. tables exist as per new schema files.
    - Update all PHP files to use new/renamed columns.

## 8. General Migration Steps
- Use `db_checklist.php` or similar script to automate comparison of old vs new tables/columns.
- Update all PHP queries (SELECT/INSERT/UPDATE) to match new schema.
- Test all features after migration: login, registration, property/project listing, MLM, booking, contact, email, etc.

---

## Summary Table
| Feature/Page         | Table(s) Needed           | Migration Action                  |
|----------------------|--------------------------|-----------------------------------|
| login/register       | users                    | Ensure table/columns exist, update code |
| associate dashboard  | associates, users        | Check new structure, update code   |
| contact form         | contact_backup           | Recreate table if missing          |
| booking management   | bookings, plots, users   | Verify structure, update code      |
| admin panel          | admin, roles             | Ensure tables, update permissions  |
| MLM/commission       | associates, payouts, etc.| Check new tables, update logic     |
| gallery/news/etc.    | gallery, news, etc.      | Ensure tables, update queries      |

---

**Last Updated:** 2025-05-01

> Review this file after every major migration or schema change. Update code and DB as per this checklist.
