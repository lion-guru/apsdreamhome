<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>APS Dream Home - API Documentation</title>
  <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui.css">
  <style>
    html {
      box-sizing: border-box;
      overflow: -moz-scrollbars-vertical;
      overflow-y: scroll;
    }
    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }
    body {
      margin: 0;
      background: #fafafa;
    }
    .topbar {
      background-color: #1a1a1a;
      padding: 10px 0;
    }
    .topbar .wrapper {
      max-width: 1460px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .topbar img {
      height: 40px;
    }
    .topbar a {
      color: #fff;
      text-decoration: none;
      margin-left: 20px;
      font-family: sans-serif;
    }
    .topbar a:hover {
      text-decoration: underline;
    }
    .info {
      max-width: 1400px;
      margin: 20px auto;
      padding: 0 20px;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="wrapper">
      <img src="https://via.placeholder.com/200x50?text=APS+Dream+Home" alt="APS Dream Home">
      <div>
        <a href="https://yourdomain.com">Back to Website</a>
        <a href="https://yourdomain.com/api/v1/README.md">API Reference</a>
      </div>
    </div>
  </div>

  <div class="info">
    <h1>API Documentation</h1>
    <p>Welcome to the APS Dream Home API documentation. Use the interactive documentation below to explore and test the API endpoints.</p>
  </div>

  <div id="swagger-ui"></div>

  <script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-bundle.js"></script>
  <script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-standalone-preset.js"></script>
  <script>
    window.onload = function() {
      // Begin Swagger UI call region
      const ui = SwaggerUIBundle({
        url: "/apsdreamhome/api/v1/openapi.json",
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "BaseLayout",
        requestInterceptor: (req) => {
          // Add API key to all requests if available
          const apiKey = localStorage.getItem('api_key');
          if (apiKey) {
            req.headers['X-API-Key'] = apiKey;
          }
          return req;
        },
        onComplete: () => {
          // Add API key input field
          const apiKeyInput = `
            <div class="api-key-container" style="margin: 20px 0;">
              <h4>API Key</h4>
              <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="password" id="api_key" class="form-control" placeholder="Enter your API key" 
                       style="width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                       value="${localStorage.getItem('api_key') || ''}">
                <button class="btn" id="save_api_key" style="padding: 8px 16px; background: #4990e2; color: white; border: none; border-radius: 4px; cursor: pointer;">
                  Save Key
                </button>
                <button class="btn" id="clear_api_key" style="padding: 8px 16px; background: #f5f5f5; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">
                  Clear
                </button>
              </div>
            </div>
          `;
          
          document.querySelector('.info').insertAdjacentHTML('beforeend', apiKeyInput);
          
          // Add event listeners
          document.getElementById('save_api_key').addEventListener('click', () => {
            const apiKey = document.getElementById('api_key').value.trim();
            if (apiKey) {
              localStorage.setItem('api_key', apiKey);
              ui.specActions.download(); // Refresh the UI to apply the key
              alert('API key saved. Refreshing documentation...');
            }
          });
          
          document.getElementById('clear_api_key').addEventListener('click', () => {
            localStorage.removeItem('api_key');
            document.getElementById('api_key').value = '';
            ui.specActions.download(); // Refresh the UI
          });
          
          // Toggle API key visibility
          const toggleKey = document.createElement('span');
          toggleKey.innerHTML = 'ðŸ‘ï¸';
          toggleKey.style.cursor = 'pointer';
          toggleKey.style.marginLeft = '10px';
          toggleKey.title = 'Show/hide API key';
          toggleKey.onclick = () => {
            const input = document.getElementById('api_key');
            input.type = input.type === 'password' ? 'text' : 'password';
          };
          document.querySelector('.api-key-container').appendChild(toggleKey);
        }
      });
      
      window.ui = ui;
    };
  </script>
</body>
</html>
